@{
    ViewBag.Title = "JamesNet";
}

<h1>JamesNet</h1>
<p>The <em>actually functional</em> WebSocket web chat system...sort of.</p>

<h2>Chat</h2>
<div class="container">
    <input type="text" id="message" />
    <input type="submit" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion"></ul>
</div>
@section scripts {
    <script src="~/Scripts/jquery.signalR-2.2.3.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script>
        $(function () {
            var chat = $.connection.chatHub;
            chat.client.receiveMessage = function (name, message) {
                // Add the message to the page.
                $('#discussion').append('<p><strong class="username">' + name
                    + '</strong>: ' + message + '</p>');
            };

            // Start the connection.
            $.connection.hub.start().done(function () {
                // Get the user name, sanitized by the server, and store it for later use.
                chat.server.validate(prompt('Enter your username for this session:', '')).done(function (result) {
                    $('#displayname').val(result);
                });

                $('#message').focus();
                $('#sendmessage').click(function () {
                    chat.server.send($('#displayname').val(), $('#message').val());
                    $('#message').val('').focus();
                });
            });
        });
    </script>
}